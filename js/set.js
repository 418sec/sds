(function() {
  /*
   0000000  00000000  000000000
  000       000          000   
  0000000   0000000      000   
       000  000          000   
  0000000   00000000     000   
  */
  /*
   * accepts an object, a keypath as an array or string and a value
   * returns the object with value set at keypath
   */
  var _, set;

  ({_} = require('kxk'));

  set = function(object, keypath, value = void 0) {
    var k, kp, o;
    if (_.isString(keypath)) {
      keypath = keypath.split('.');
    }
    if (!_.isArray(keypath)) {
      throw `invalid keypath: ${JSON.stringify(keypath)}`;
    }
    kp = _.clone(keypath);
    o = object;
    while (kp.length > 1) {
      k = kp.shift();
      if (o[k] == null) {
        if (!_.isNaN(_.parseInt(k))) {
          o = o[k] = [];
        } else {
          o = o[k] = {};
        }
      } else {
        o = o[k];
      }
    }
    if (kp.length === 1 && (o != null)) {
      if (value === void 0) {
        delete o[kp[0]];
      } else {
        o[kp[0]] = value;
        if (o[kp[0]] !== value) {
          throw `couldn't set value ${JSON.stringify(value)} for keypath ${keypath.join('.')} in ${JSON.stringify(object)}`;
        }
      }
    }
    return object;
  };

  module.exports = set;

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2V0LmpzIiwic291cmNlUm9vdCI6Ii4uIiwic291cmNlcyI6WyJjb2ZmZWUvc2V0LmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUFBOzs7Ozs7Ozs7OztBQUFBLE1BQUEsQ0FBQSxFQUFBOztFQVFBLENBQUEsQ0FBRSxDQUFGLENBQUEsR0FBUSxPQUFBLENBQVEsS0FBUixDQUFSOztFQU9BLEdBQUEsR0FBTSxRQUFBLENBQUMsTUFBRCxFQUFTLE9BQVQsRUFBa0IsUUFBTSxNQUF4QixDQUFBO0FBRUYsUUFBQSxDQUFBLEVBQUEsRUFBQSxFQUFBO0lBQUEsSUFBK0IsQ0FBQyxDQUFDLFFBQUYsQ0FBVyxPQUFYLENBQS9CO01BQUEsT0FBQSxHQUFVLE9BQU8sQ0FBQyxLQUFSLENBQWMsR0FBZCxFQUFWOztJQUNBLElBQXNELENBQUksQ0FBQyxDQUFDLE9BQUYsQ0FBVSxPQUFWLENBQTFEO01BQUEsTUFBTSxDQUFBLGlCQUFBLENBQUEsQ0FBb0IsSUFBSSxDQUFDLFNBQUwsQ0FBZSxPQUFmLENBQXBCLENBQUEsRUFBTjs7SUFFQSxFQUFBLEdBQUssQ0FBQyxDQUFDLEtBQUYsQ0FBUSxPQUFSO0lBQ0wsQ0FBQSxHQUFJO0FBRUosV0FBTSxFQUFFLENBQUMsTUFBSCxHQUFZLENBQWxCO01BQ0ksQ0FBQSxHQUFJLEVBQUUsQ0FBQyxLQUFILENBQUE7TUFDSixJQUFPLFlBQVA7UUFDSSxJQUFHLENBQUksQ0FBQyxDQUFDLEtBQUYsQ0FBUSxDQUFDLENBQUMsUUFBRixDQUFXLENBQVgsQ0FBUixDQUFQO1VBQ0ksQ0FBQSxHQUFJLENBQUUsQ0FBQSxDQUFBLENBQUYsR0FBTyxHQURmO1NBQUEsTUFBQTtVQUdJLENBQUEsR0FBSSxDQUFFLENBQUEsQ0FBQSxDQUFGLEdBQU8sQ0FBQSxFQUhmO1NBREo7T0FBQSxNQUFBO1FBTUksQ0FBQSxHQUFJLENBQUUsQ0FBQSxDQUFBLEVBTlY7O0lBRko7SUFVQSxJQUFHLEVBQUUsQ0FBQyxNQUFILEtBQWEsQ0FBYixJQUFtQixXQUF0QjtNQUNJLElBQUcsS0FBQSxLQUFTLE1BQVo7UUFDSSxPQUFPLENBQUUsQ0FBQSxFQUFHLENBQUEsQ0FBQSxDQUFILEVBRGI7T0FBQSxNQUFBO1FBR0ksQ0FBRSxDQUFBLEVBQUcsQ0FBQSxDQUFBLENBQUgsQ0FBRixHQUFXO1FBQ1gsSUFBRyxDQUFFLENBQUEsRUFBRyxDQUFBLENBQUEsQ0FBSCxDQUFGLEtBQVksS0FBZjtVQUNJLE1BQU0sQ0FBQSxtQkFBQSxDQUFBLENBQXNCLElBQUksQ0FBQyxTQUFMLENBQWUsS0FBZixDQUF0QixDQUEyQyxhQUEzQyxDQUFBLENBQTBELE9BQU8sQ0FBQyxJQUFSLENBQWEsR0FBYixDQUExRCxDQUEyRSxJQUEzRSxDQUFBLENBQWlGLElBQUksQ0FBQyxTQUFMLENBQWUsTUFBZixDQUFqRixDQUFBLEVBRFY7U0FKSjtPQURKOztXQU9BO0VBekJFOztFQTJCTixNQUFNLENBQUMsT0FBUCxHQUFpQjtBQTFDakIiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbiAwMDAwMDAwICAwMDAwMDAwMCAgMDAwMDAwMDAwXG4wMDAgICAgICAgMDAwICAgICAgICAgIDAwMCAgIFxuMDAwMDAwMCAgIDAwMDAwMDAgICAgICAwMDAgICBcbiAgICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgXG4wMDAwMDAwICAgMDAwMDAwMDAgICAgIDAwMCAgIFxuIyMjXG5cbnsgXyB9ID0gcmVxdWlyZSAna3hrJ1xuXG4jIyNcbiMgYWNjZXB0cyBhbiBvYmplY3QsIGEga2V5cGF0aCBhcyBhbiBhcnJheSBvciBzdHJpbmcgYW5kIGEgdmFsdWVcbiMgcmV0dXJucyB0aGUgb2JqZWN0IHdpdGggdmFsdWUgc2V0IGF0IGtleXBhdGhcbiMjI1xuXG5zZXQgPSAob2JqZWN0LCBrZXlwYXRoLCB2YWx1ZT11bmRlZmluZWQpIC0+XG4gICAgXG4gICAga2V5cGF0aCA9IGtleXBhdGguc3BsaXQgJy4nIGlmIF8uaXNTdHJpbmcga2V5cGF0aFxuICAgIHRocm93IFwiaW52YWxpZCBrZXlwYXRoOiAje0pTT04uc3RyaW5naWZ5IGtleXBhdGh9XCIgaWYgbm90IF8uaXNBcnJheSBrZXlwYXRoXG4gICAgXG4gICAga3AgPSBfLmNsb25lIGtleXBhdGhcbiAgICBvID0gb2JqZWN0XG4gICAgXG4gICAgd2hpbGUga3AubGVuZ3RoID4gMVxuICAgICAgICBrID0ga3Auc2hpZnQoKVxuICAgICAgICBpZiBub3Qgb1trXT9cbiAgICAgICAgICAgIGlmIG5vdCBfLmlzTmFOIF8ucGFyc2VJbnQga1xuICAgICAgICAgICAgICAgIG8gPSBvW2tdID0gW11cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBvID0gb1trXSA9IHt9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIG8gPSBvW2tdXG4gICAgICAgICAgICBcbiAgICBpZiBrcC5sZW5ndGggPT0gMSBhbmQgbz9cbiAgICAgICAgaWYgdmFsdWUgPT0gdW5kZWZpbmVkXG4gICAgICAgICAgICBkZWxldGUgb1trcFswXV1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgb1trcFswXV0gPSB2YWx1ZVxuICAgICAgICAgICAgaWYgb1trcFswXV0gIT0gdmFsdWVcbiAgICAgICAgICAgICAgICB0aHJvdyBcImNvdWxkbid0IHNldCB2YWx1ZSAje0pTT04uc3RyaW5naWZ5IHZhbHVlfSBmb3Iga2V5cGF0aCAje2tleXBhdGguam9pbiAnLid9IGluICN7SlNPTi5zdHJpbmdpZnkgb2JqZWN0fVwiXG4gICAgb2JqZWN0XG5cbm1vZHVsZS5leHBvcnRzID0gc2V0XG4iXX0=
//# sourceURL=C:/Users/kodi/s/sds/coffee/set.coffee